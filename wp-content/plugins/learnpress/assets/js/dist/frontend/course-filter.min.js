(()=>{"use strict";const e={};"undefined"!=typeof lpDataAdmin&&(e.admin={apiAdminNotice:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/admin-notices",apiAdminOrderStatic:lpDataAdmin.lp_rest_url+"lp/v1/orders/statistic",apiAddons:lpDataAdmin.lp_rest_url+"lp/v1/addon/all",apiAddonAction:lpDataAdmin.lp_rest_url+"lp/v1/addon/action",apiSearchCourses:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/search-course",apiSearchUsers:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/search-user",apiAssignUserCourse:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/assign-user-course",apiUnAssignUserCourse:lpDataAdmin.lp_rest_url+"lp/v1/admin/tools/unassign-user-course"}),"undefined"!=typeof lpData&&(e.frontend={apiWidgets:lpData.lp_rest_url+"lp/v1/widgets/api",apiCourses:lpData.lp_rest_url+"lp/v1/courses/archive-course",apiAJAX:lpData.lp_rest_url+"lp/v1/load_content_via_ajax/"});const t=e,r="lp-form-course-filter";let s,a,l;document.addEventListener("submit",(function(e){const t=e.target;t.classList.contains(r)&&(e.preventDefault(),window.lpCourseFilter.submit(t))})),document.addEventListener("click",(function(e){const t=e.target;t.classList.contains("course-filter-reset")&&(e.preventDefault(),window.lpCourseFilter.reset(t)),window.lpCourseFilter.showHideSearchResult(t),window.lpCourseFilter.triggerInputChoice(t)})),document.addEventListener("keyup",(function(e){e.preventDefault();const t=e.target;t.classList.contains("lp-course-filter-search")&&window.lpCourseFilter.searchSuggestion(t)})),window.lpCourseFilter={searchSuggestion:e=>{if(1!==parseInt(e.dataset.searchSuggest||1))return;const t=e.value.trim(),a=e.closest(`.${r}`),l=a.querySelector(".lp-loading-circle");void 0!==s&&clearTimeout(s),t&&t.length>2?(l.classList.remove("hide"),s=setTimeout((function(){window.lpCourseFilter.callAPICourseSuggest(t,(e=>{document.querySelector(".lp-course-filter-search-result").innerHTML=e.data.content,l.classList.add("hide")}))}),500)):(a.querySelector(".lp-course-filter-search-result").innerHTML="",l.classList.add("hide"))},callAPICourseSuggest:(e,r,s)=>{void 0!==a&&a.abort(),a=new AbortController,l=a.signal;let o=t.frontend.apiCourses+"?c_search="+e+"&c_suggest=1";lpData.urlParams.hasOwnProperty("lang")&&(o+="&lang="+lpData.urlParams.lang);let i={method:"GET"};0!==parseInt(lpData.user_id)&&(i={...i,headers:{"X-WP-Nonce":lpData.nonce}}),fetch(o,{...i,signal:l}).then((e=>e.json())).then((e=>{void 0!==r&&r(e)})).catch((e=>{console.log(e)})).finally((()=>{void 0!==s&&s()}))},loadWidgetFilterREST:e=>{const r=e.closest(".learnpress-widget-wrapper");if(!r)return;const s=r.dataset.widget?JSON.parse(r.dataset.widget):"",a=t.frontend.apiWidgets,l=new FormData(e),o={paged:1},i=r.querySelector(".lp-widget-loading-change");i.style.display="block";for(const e of l.entries()){const t=e[0],r=l.getAll(t);if(!o.hasOwnProperty(t)){let e=r;"object"==typeof r&&(e=r.join(",")),o[t]=e}}void 0!==lpData.urlParams.page_term_id_current?o.page_term_id_current=lpData.urlParams.page_term_id_current:void 0!==lpData.urlParams.page_tag_id_current&&(o.page_tag_id_current=lpData.urlParams.page_tag_id_current);const n={params_url:o};lpData.urlParams.hasOwnProperty("lang")&&(n.params_url.lang=lpData.urlParams.lang);const c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,...n})};0!==parseInt(lpData.user_id)&&(c.headers["X-WP-Nonce"]=lpData.nonce),((e,t={},r={})=>{"function"==typeof r.before&&r.before(),fetch(e,{method:"GET",...t}).then((e=>e.json())).then((e=>{"function"==typeof r.success&&r.success(e)})).catch((e=>{"function"==typeof r.error&&r.error(e)})).finally((()=>{"function"==typeof r.completed&&r.completed()}))})(a,c,{before:()=>{},success:t=>{const{data:s,status:a,message:l}=t;s&&"success"===a?e.innerHTML=s:l&&r.insertAdjacentHTML("afterbegin",`<div class="lp-ajax-message error" style="display:block">${l}</div>`)},error:e=>{},completed:()=>{i.style.display="none"}})},submit:e=>{const t=new FormData(e),r=document.querySelector(".learn-press-courses"),s={paged:1};void 0!==window.lpCourseList&&window.lpCourseList.updateEventTypeBeforeFetch("filter");for(const e of t.entries()){const r=e[0],a=t.getAll(r);s.hasOwnProperty(r)||(s[r]=a)}if(void 0!==lpData.urlParams.page_term_id_current&&(s.page_term_id_current=lpData.urlParams.page_term_id_current),void 0!==lpData.urlParams.page_tag_id_current&&(s.page_tag_id_current=lpData.urlParams.page_tag_id_current),lpData.urlParams.hasOwnProperty("lang")&&(s.lang=lpData.urlParams.lang),"undefined"!=typeof lpSettingCourses&&lpData.is_course_archive&&lpSettingCourses.lpArchiveLoadAjax&&r&&void 0!==window.lpCourseList)window.lpCourseList.triggerFetchAPI(s);else{const e=lpData.urlParams.page_term_url||lpData.courses_url||"",t=new URL(e);Object.keys(s).forEach((e=>{t.searchParams.set(e,s[e])})),document.location.href=t.href}},reset:e=>{const t=e.closest(`.${r}`),s=t.querySelector(".course-filter-submit"),a=t.querySelector(".lp-course-filter-search-result"),l=t.querySelector(".lp-course-filter-search");t.reset(),a&&(a.innerHTML=""),l&&(l.value="");for(let e=0;e<t.elements.length;e++)t.elements[e].removeAttribute("checked");lpData.is_course_archive&&s.click(),window.lpCourseFilter.loadWidgetFilterREST(t)},showHideSearchResult:e=>{const t=document.querySelector(".lp-course-filter-search-result");t&&(e.closest(".lp-course-filter-search-result")||e.classList.contains("lp-course-filter-search-result")||e.classList.contains("lp-course-filter-search")?t.style.display="block":t.style.display="none")},triggerInputChoice:e=>{if("INPUT"===e.tagName){const t=e.closest(".lp-course-filter__field");if(!t)return;const s=t.closest(`.${r}`),a=s.querySelector(".course-filter-submit");let l=!1;return l="undefined"!=typeof lpSettingCourses?parseInt(lpSettingCourses.lpArchiveLoadAjax):0,document.querySelector(".learn-press-courses")&&l&&a.click(),void window.lpCourseFilter.loadWidgetFilterREST(s)}let t;e.classList.contains("lp-course-filter__field")&&(t=e);const s=e.closest(".lp-course-filter__field");s&&(t=s),t&&t.querySelector("input").click()}}})();